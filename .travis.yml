# Config file for automatic testing at travis-ci.org
dist: bionic   # required for Python >= 3.7
language: Python

python:
  - "3.5"
  - "3.6"
  - "3.7"

sudo: false

# https://docs.travis-ci.com/user/database-setup/#cassandra
services:
  - docker

before_script:
  - docker run -d -p 9042:9042 -e CASSANDRA_BROADCAST_ADDRESS=127.0.0.1 cassandra:3.11.4
  - sleep 20
  - docker ps
  - pip install cqlsh==5.0.4
  - pip install pytz
  - bash travis/setup_cassandra.sh

before_install:
  - pip install -q --upgrade pip
  - pip install -q pycodestyle
  - pip install -q coverage
  - pip install -q pytest-cov
  - pip install -q codacy-coverage
  - pip install -r requirements.txt

# command to run tests
script:
- python setup.py test
  #- pytest --cov=dask_cassandra_loader --cov-report xml:coverage.xml

# upload coverage information to Codacy
after_success:
  - python-codacy-coverage -r coverage.xml
  - coverage report -m
  
